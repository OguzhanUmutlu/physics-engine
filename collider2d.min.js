(async()=>{function t(t,i){if(!(t instanceof i))throw TypeError("Cannot call a class as a function")}function i(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function s(t,s,e){return s&&i(t.prototype,s),e&&i(t,e),t}function e(t,i,s){return i in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}var n=function(){function i(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,i),e(this,"_x",0),e(this,"_y",0),this._x=s,this._y=n}return s(i,[{key:"x",get:function t(){return this._x},set:function t(i){this._x=i}},{key:"y",get:function t(){return this._y},set:function t(i){this._y=i}},{key:"copy",value:function t(i){return this._x=i.x,this._y=i.y,this}},{key:"clone",value:function t(){return new i(this.x,this.y)}},{key:"perp",value:function t(){var i=this.x;return this._x=this.y,this._y=-i,this}},{key:"rotate",value:function t(i){var s=this.x,e=this.y;return this._x=s*Math.cos(i)-e*Math.sin(i),this._y=s*Math.sin(i)+e*Math.cos(i),this}},{key:"reverse",value:function t(){return this._x=-this.x,this._y=-this.y,this}},{key:"normalize",value:function t(){var i=this.len();return i>0&&(this._x=this.x/i,this._y=this.y/i),this}},{key:"add",value:function t(i){return this._x+=i.x,this._y+=i.y,this}},{key:"sub",value:function t(i){return this._x-=i.x,this._y-=i.y,this}},{key:"scale",value:function t(i,s){return this._x*=i,this._y*=void 0!==s?s:i,this}},{key:"project",value:function t(i){var s=this.dot(i)/i.len2();return this._x=s*i.x,this._y=s*i.y,this}},{key:"projectN",value:function t(i){var s=this.dot(i);return this._x=s*i.x,this._y=s*i.y,this}},{key:"reflect",value:function t(i){var s=this.x,e=this.y;return this.project(i).scale(2),this._x-=s,this._y-=e,this}},{key:"reflectN",value:function t(i){var s=this.x,e=this.y;return this.projectN(i).scale(2),this._x-=s,this._y-=e,this}},{key:"dot",value:function t(i){return this.x*i.x+this.y*i.y}},{key:"len2",value:function t(){return this.dot(this)}},{key:"len",value:function t(){return Math.sqrt(this.len2())}}]),i}(),o=function(){function i(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t(this,i),e(this,"_position",new n),e(this,"_points",[]),e(this,"_pointsGeneric",[]),e(this,"_angle",0),e(this,"_offset",new n),e(this,"_calcPoints",[]),e(this,"_edges",[]),e(this,"_normals",[]),this._position=s,this.setPoints(o)}return s(i,[{key:"position",get:function t(){return this._position}},{key:"points",get:function t(){return this._points}},{key:"pointsGeneric",get:function t(){return this._pointsGeneric}},{key:"calcPoints",get:function t(){return this._calcPoints}},{key:"offset",get:function t(){return this._offset}},{key:"angle",get:function t(){return this._angle}},{key:"edges",get:function t(){return this._edges}},{key:"normals",get:function t(){return this._normals}},{key:"setPoints",value:function t(i){if(!this.points||this.points.length!==i.length){var s,e=this._calcPoints=[],o=this._edges=[],h=this._normals=[];for(s=0;s<i.length;s++){var r=i[s],u=s<i.length-1?i[s+1]:i[0];if(this._pointsGeneric.push(i[s].x,i[s].y),r!==u&&r.x===u.x&&r.y===u.y){i.splice(s,1),s-=1;continue}e.push(new n),o.push(new n),h.push(new n)}}return this._points=i,this._recalc(),this}},{key:"setAngle",value:function t(i){return this._angle=i,this._recalc(),this}},{key:"setOffset",value:function t(i){return this._offset=i,this._recalc(),this}},{key:"rotate",value:function t(i){for(var s=this.points,e=s.length,n=0;n<e;n++)s[n].rotate(i);return this._recalc(),this}},{key:"translate",value:function t(i,s){for(var e=this.points,n=e.length,o=0;o<n;o++)e[o].x+=i,e[o].y+=s;return this._recalc(),this}},{key:"_recalc",value:function t(){var i,s=this.calcPoints,e=this._edges,n=this._normals,o=this.points,h=this.offset,r=this.angle,u=o.length;for(i=0;i<u;i++){var a=s[i].copy(o[i]);a.x+=h.x,a.y+=h.y,0!==r&&a.rotate(r)}for(i=0;i<u;i++){var l=s[i],c=i<u-1?s[i+1]:s[0],I=e[i].copy(c).sub(l);n[i].copy(I).perp().normalize()}return this}},{key:"getAABB",value:function t(){for(var s=this.calcPoints,e=s.length,o=s[0].x,h=s[0].y,r=s[0].x,u=s[0].y,a=1;a<e;a++){var l=s[a];l.x<o?o=l.x:l.x>r&&(r=l.x),l.y<h?h=l.y:l.y>u&&(u=l.y)}return new i(this._position.clone().add(new n(o,h)),[new n,new n(r-o,0),new n(r-o,u-h),new n(0,u-h)])}},{key:"getCentroid",value:function t(){for(var i=this.calcPoints,s=i.length,e=0,o=0,h=0,r=0;r<s;r++){var u=i[r],a=r===s-1?i[0]:i[r+1],l=u.x*a.y-a.x*u.y;e+=(u.x+a.x)*l,o+=(u.y+a.y)*l,h+=l}return h*=3,e/=h,o/=h,new n(e,o)}}]),i}(),h=function(){function i(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,i),e(this,"_position",new n),e(this,"_width",0),e(this,"_height",0),this._position=s,this._width=o,this._height=h}return s(i,[{key:"toPolygon",value:function t(){return new o(new n(this._position.x,this._position.y),[new n,new n(this._width,0),new n(this._width,this._height),new n(0,this._height)])}}]),i}(),r=function(){function i(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,i),e(this,"_position",new n),e(this,"_radius",0),e(this,"_offset",new n),this._position=s,this._radius=o}return s(i,[{key:"position",get:function t(){return this._position}},{key:"radius",get:function t(){return this._radius}},{key:"offset",get:function t(){return this._offset},set:function t(i){this._offset=i}},{key:"translate",value:function t(i,s){this._position.x+=i,this._position.y+=s}},{key:"getAABB",value:function t(){var i=this._position.clone().add(this._offset).sub(new n(this._radius,this._radius));return new h(i,2*this._radius,2*this._radius).toPolygon()}},{key:"setOffset",value:function t(i){return this._offset=i,this}}]),i}(),u=function(){function i(){t(this,i),e(this,"a",void 0),e(this,"b",void 0),e(this,"overlapN",new n),e(this,"overlapV",new n),e(this,"overlap",Number.MAX_VALUE),e(this,"aInB",!0),e(this,"bInA",!0),this.clear()}return s(i,[{key:"clear",value:function t(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this}}]),i}(),a=function(){function i(){t(this,i),e(this,"_T_VECTORS",[]),e(this,"_T_ARRAYS",[]),e(this,"_T_COLLISION_DETAILS",new u),e(this,"_TEST_POINT",new h(new n,1e-6,1e-6).toPolygon()),e(this,"_LEFT_VORONOI_REGION",-1),e(this,"_MIDDLE_VORONOI_REGION",0),e(this,"_RIGHT_VORONOI_REGION",1);for(var s=0;s<10;s++)this._T_VECTORS.push(new n);for(var o=0;o<5;o++)this._T_ARRAYS.push([])}return s(i,[{key:"pointInCircle",value:function t(i,s){var e=this._T_VECTORS.pop().copy(i).sub(s.position).sub(s.offset),n=s.radius*s.radius,o=e.len2();return this._T_VECTORS.push(e),o<=n}},{key:"pointInPolygon",value:function t(i,s){this._TEST_POINT.position.copy(i),this._T_COLLISION_DETAILS.clear();var e=this.testPolygonPolygon(this._TEST_POINT,s,!0);return e&&(e=this._T_COLLISION_DETAILS.aInB),e}},{key:"testCircleCircle",value:function t(i,s){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._T_VECTORS.pop().copy(s.position).add(s.offset).sub(i.position).sub(i.offset),o=i.radius+s.radius,h=n.len2();if(h>o*o)return this._T_VECTORS.push(n),!1;if(e){this._T_COLLISION_DETAILS.clear();var r=Math.sqrt(h);return this._T_COLLISION_DETAILS.a=i,this._T_COLLISION_DETAILS.b=s,this._T_COLLISION_DETAILS.overlap=o-r,this._T_COLLISION_DETAILS.overlapN.copy(n.normalize()),this._T_COLLISION_DETAILS.overlapV.copy(n).scale(this._T_COLLISION_DETAILS.overlap),this._T_COLLISION_DETAILS.aInB=i.radius<=s.radius&&r<=s.radius-i.radius,this._T_COLLISION_DETAILS.bInA=s.radius<=i.radius&&r<=i.radius-s.radius,this._T_COLLISION_DETAILS}return this._T_VECTORS.push(n),!0}},{key:"testPolygonPolygon",value:function t(i,s){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._T_COLLISION_DETAILS.clear();for(var n=i.calcPoints,o=n.length,h=s.calcPoints,r=h.length,u=0;u<o;u++)if(this._isSeparatingAxis(i.position,s.position,n,h,i.normals[u],this._T_COLLISION_DETAILS))return!1;for(var a=0;a<r;a++)if(this._isSeparatingAxis(i.position,s.position,n,h,s.normals[a],this._T_COLLISION_DETAILS))return!1;return!e||(this._T_COLLISION_DETAILS.a=i,this._T_COLLISION_DETAILS.b=s,this._T_COLLISION_DETAILS.overlapV.copy(this._T_COLLISION_DETAILS.overlapN).scale(this._T_COLLISION_DETAILS.overlap),this._T_COLLISION_DETAILS)}},{key:"testPolygonCircle",value:function t(i,s){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._T_COLLISION_DETAILS.clear();for(var n=this._T_VECTORS.pop().copy(s.position).add(s.offset).sub(i.position),o=s.radius,h=o*o,r=i.calcPoints,u=r.length,a=this._T_VECTORS.pop(),l=this._T_VECTORS.pop(),c=0;c<u;c++){var I=c===u-1?0:c+1,T=0===c?u-1:c-1,p=0,f=null;a.copy(i.edges[c]),l.copy(n).sub(r[c]),e&&l.len2()>h&&(this._T_COLLISION_DETAILS.aInB=!1);var O=this._voronoiRegion(a,l);if(O===this._LEFT_VORONOI_REGION){a.copy(i.edges[T]);var v=this._T_VECTORS.pop().copy(n).sub(r[T]);if((O=this._voronoiRegion(a,v))===this._RIGHT_VORONOI_REGION){var y=l.len();if(y>o)return this._T_VECTORS.push(n),this._T_VECTORS.push(a),this._T_VECTORS.push(l),this._T_VECTORS.push(v),!1;e&&(this._T_COLLISION_DETAILS.bInA=!1,f=l.normalize(),p=o-y)}this._T_VECTORS.push(v)}else if(O===this._RIGHT_VORONOI_REGION){if(a.copy(i.edges[I]),l.copy(n).sub(r[I]),(O=this._voronoiRegion(a,l))===this._LEFT_VORONOI_REGION){var L=l.len();if(L>o)return this._T_VECTORS.push(n),this._T_VECTORS.push(a),this._T_VECTORS.push(l),!1;e&&(this._T_COLLISION_DETAILS.bInA=!1,f=l.normalize(),p=o-L)}}else{var S=a.perp().normalize(),$=l.dot(S),E=Math.abs($);if($>0&&E>o)return this._T_VECTORS.push(n),this._T_VECTORS.push(S),this._T_VECTORS.push(l),!1;e&&(f=S,p=o-$,($>=0||p<2*o)&&(this._T_COLLISION_DETAILS.bInA=!1))}f&&e&&Math.abs(p)<Math.abs(this._T_COLLISION_DETAILS.overlap)&&(this._T_COLLISION_DETAILS.overlap=p,this._T_COLLISION_DETAILS.overlapN.copy(f))}return e&&(this._T_COLLISION_DETAILS.a=i,this._T_COLLISION_DETAILS.b=s,this._T_COLLISION_DETAILS.overlapV.copy(this._T_COLLISION_DETAILS.overlapN).scale(this._T_COLLISION_DETAILS.overlap)),this._T_VECTORS.push(n),this._T_VECTORS.push(a),this._T_VECTORS.push(l),!e||this._T_COLLISION_DETAILS}},{key:"testCirclePolygon",value:function t(i,s){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.testPolygonCircle(s,i,e);if(n&&e){var o=n,h=o.a,r=o.aInB;o.overlapN.reverse(),o.overlapV.reverse(),o.a=o.b,o.b=h,o.aInB=o.bInA,o.bInA=r}return n}},{key:"_isSeparatingAxis",value:function t(i,s,e,n,o,h){var r=this._T_ARRAYS.pop(),u=this._T_ARRAYS.pop(),a=this._T_VECTORS.pop().copy(s).sub(i),l=a.dot(o);if(this._flattenPointsOn(e,o,r),this._flattenPointsOn(n,o,u),u[0]+=l,u[1]+=l,r[0]>u[1]||u[0]>r[1])return this._T_VECTORS.push(a),this._T_ARRAYS.push(r),this._T_ARRAYS.push(u),!0;if(h){var c=0;if(r[0]<u[0]){if(h.aInB=!1,r[1]<u[1])c=r[1]-u[0],h.bInA=!1;else{var I=r[1]-u[0],T=u[1]-r[0];c=I<T?I:-T}}else if(h.bInA=!1,r[1]>u[1])c=r[0]-u[1],h.aInB=!1;else{var p=r[1]-u[0],f=u[1]-r[0];c=p<f?p:-f}var O=Math.abs(c);O<h.overlap&&(h.overlap=O,h.overlapN.copy(o),c<0&&h.overlapN.reverse())}return this._T_VECTORS.push(a),this._T_ARRAYS.push(r),this._T_ARRAYS.push(u),!1}},{key:"_flattenPointsOn",value:function t(i,s,e){for(var n=Number.MAX_VALUE,o=-Number.MAX_VALUE,h=i.length,r=0;r<h;r++){var u=i[r].dot(s);u<n&&(n=u),u>o&&(o=u)}e[0]=n,e[1]=o}},{key:"_voronoiRegion",value:function t(i,s){var e=i.len2(),n=s.dot(i);return n<0?this._LEFT_VORONOI_REGION:n>e?this._RIGHT_VORONOI_REGION:this._MIDDLE_VORONOI_REGION}}]),i}();window.Collider2D={Box:h,Circle:r,Collider2D:a,Polygon:o,Vector:n}})();
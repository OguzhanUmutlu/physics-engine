!async function(){let isWeb="object"==typeof window&&"undefined"==typeof require,_global=isWeb?window:global,_exports=isWeb?window:module.exports,_p,_id=0;_exports.Phygic=new Promise(t=>_p=t);let Collider2D=isWeb?await async function(){if(void 0!==window.Collider2D)return Collider2D;let t=document.createElement("script");return t.src="./collider2d.min.js",document.body.appendChild(t),await new Promise(e=>t.onload=e),window.Collider2D}():require("collider2d"),_requestAnimationFrame=t=>{if(isWeb)return requestAnimationFrame(t);process.nextTick(t)},_cancelAnimationFrame=t=>{isWeb&&cancelAnimationFrame(t)},collider=new Collider2D.Collider2D,{PI,floor,ceil,round,sqrt,pow,sin,cos,tan,abs,atan,atan2,min,max}=Math;function processOptions(options,def,mode=0){switch(("object"!=typeof options||Array.isArray(options))&&(options={}),mode){case 0:Object.keys(def).forEach(t=>typeof options[t]!=typeof def[t]&&(options[t]=def[t]));break;case 1:Object.keys(def).forEach(t=>!Object.keys(options).includes(t)&&(options[t]=def[t]));break;case 2:def.forEach(i=>typeof eval(`options.${i[0]}`)!=typeof i[1]&&eval(`options.${i[0]} = i[1]`))}return options}function extendClass(t,e){Object.keys(e.prototype).forEach(i=>t.prototype[i]=e.prototype[i])}function positiveModulo(t,e){return(t%=e)<0&&(t+=e),t}function Vector2(t=0,e=0){this.x=t,this.y=e}function Circle(t){this.radius=t,this.fill="#000000",this.stroke="",this.type="circle"}function PathShape(t){this.fill="#000000",this.stroke="",this.type="path",this.isPathShape=!0,Object.defineProperty(this,"path",{get:()=>t,set:e=>{t=e,this._hasChanged=!0}})}function Polygon(t,e){this.fill="#000000",this.stroke="",this.type="polygon",this.isPathShape=!0,this._sides=t,this._radius=e,this.setSides(t),Object.defineProperties(this,{sides:{get:()=>this._sides,set:t=>{this._sides=t,this.setSides(this._sides)}},radius:{get:()=>this._radius,set:t=>{this._radius=t,this.setRadius(this._radius)}}})}function Rectangle(t,e){this.fill="#000000",this.stroke="",this.setSize(t,e),this.type="rectangle",this.isPathShape=!0,this._width=t,this._height=e,Object.defineProperties(this,{width:{get:()=>this._width,set:t=>{this._width=t,this.setSize(this._width,this._height)}},height:{get:()=>this._height,set:t=>{this._height=t,this.setSize(this._width,this._height)}}})}Vector2.prototype.add=function(t){return new Vector2(this.x+t.x,this.y+t.y)},Vector2.prototype.sub=function(t){return new Vector2(this.x-t.x,this.y-t.y)},Vector2.prototype.mul=function(t){return new Vector2(this.x*t.x,this.y*t.y)},Vector2.prototype.div=function(t){return new Vector2(this.x/t.x,this.y/t.y)},Vector2.prototype.scale=function(t){return new Vector2(this.x*t,this.y*t)},Vector2.prototype.floor=function(){return new Vector2(floor(this.x),floor(this.y))},Vector2.prototype.ceil=function(){return new Vector2(ceil(this.x),ceil(this.y))},Vector2.prototype.round=function(){return new Vector2(round(this.x),round(this.y))},Vector2.prototype.len=function(){return sqrt(this.x**2+this.y**2)},Vector2.prototype.dist=function(t){return this.sub(t).len()},Vector2.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Vector2.prototype.set=function(t){this.x=t.x,this.y=t.y},Vector2.prototype.clone=function(){return new Vector2(this.x,this.y)},Vector2.zero=()=>new Vector2,Circle.prototype.draw=function(t,e){let i=t.ctx;i.save(),i.translate(t.translation.x,t.translation.y),i.fillStyle=this.fill,i.strokeStyle=this.stroke,i.beginPath(),i.scale(t.scale,t.scale),i.arc(e.x,e.y,this.radius,0,2*PI),this.fill&&i.fill(),this.stroke&&i.stroke(),i.closePath();let s=t.options.render,o=s.collisions;i.fillStyle=o.color,i.fillRect(e.x-o.size/2,e.y-o.size/2,o.size,o.size),e.lastMoveGround&&i.fillRect(e.x,e.lastMoveGround.interY,5,5),i.restore()},PathShape.prototype.draw=function(t,e){let i=t.ctx;i.save(),i.translate(t.translation.x,t.translation.y),i.fillStyle=this.fill,i.strokeStyle=this.stroke,(this._lastRotation!==e.rotation||this._hasChanged)&&(this._lastRotation=e.rotation,this._hasChanged=!1,this._lastPoints=this.path.map(t=>{let i=t[0],s=t[1];return[i*cos(e.rotation)+s*sin(e.rotation),-i*sin(e.rotation)+s*cos(e.rotation)]})),i.beginPath(),i.scale(t.scale,t.scale),(this._lastPoints||this.path).forEach((t,s)=>i[0===s?"moveTo":"lineTo"](e.x+t[0],e.y+t[1])),this.fill&&i.fill(),this.stroke&&i.stroke(),i.closePath();let s=t.options.render,o=s.collisions;i.fillStyle=o.color,(this._lastPoints||this.path).forEach(t=>i.fillRect(e.x+t.y-o.size/2,e.y+t.y-o.size/2,o.size,o.size)),i.fillRect(e.x-o.size/2,e.y-o.size/2,o.size,o.size),e.lastMoveGround&&i.fillRect(e.x,e.lastMoveGround.interY,5,5),i.restore()},Polygon.prototype.setRadius=function(t){this._radius=t,this.setSides(this._sides)},Polygon.prototype.setSides=function(t){this._sides=t,this.path=[..." ".repeat(t)].map((e,i)=>[sin(2*PI/t*(i-.5))*this._radius,cos(2*PI/t*(i-.5))*this._radius]),this.path.push(this.path[0])},Polygon.prototype.setRadiusAndSides=function(t,e){this._radius=t,this.setSides(e)},Rectangle.prototype.setSize=function(t,e){this._width=t,this._height=e,this.path=[[-t/2,-e/2],[t/2,-e/2],[t/2,e/2],[-t/2,e/2]]};let tiles={};function Tile(t=0,e=0,i){Vector2.apply(this,arguments),i instanceof World&&(i={world:i}),i=processOptions(i,{shape:new Rectangle(20,20),rotation:0,isStatic:!1,world:null,mass:10,staticFrictionCoefficient:0,kineticFrictionCoefficient:0,dragCoefficient:1,gravityEnabled:!0},1);let s=_id++;tiles[s]=this,Object.defineProperty(this,"id",{get:()=>s}),this.shape=i.shape,"number"==typeof i.angle?this.setAngle(i.angle):this.setRotation(i.rotation),this.verticalVelocity=0,this.horizontalVelocity=0,this.force=Vector2.zero(),this.motion=Vector2.zero(),this.mass=i.mass,this.isStatic=i.isStatic,this.gravityEnabled=i.gravityEnabled,this.dragCoefficient=i.dragCoefficient,this.staticFrictionCoefficient=i.staticFrictionCoefficient,this.kineticFrictionCoefficient=i.kineticFrictionCoefficient,this.airTicks=0,this.outOfDistance=!1,i.world instanceof World&&i.world.addTile(this),this.initOptions=i,Object.freeze(this.initOptions)}Tile.getById=function(t){return tiles[t]},Tile.prototype.setRotation=function(t){this.rotationTarget=t,this.rotation=t},Tile.prototype.setAngle=function(t){this.setRotation(t/180*PI)},Tile.prototype.getRadius=function(){switch(this.shape?.type){case"polygon":case"rectangle":let t=this.shape.path.map(t=>t[0]),e=t.sort((t,e)=>e-t)[0]-t.sort((t,e)=>t-e)[0],i=this.shape.path.map(t=>t[1]),s=i.sort((t,e)=>e-t)[0]-i.sort((t,e)=>t-e)[0];return sqrt(e**2+s**2);case"circle":return this.shape.radius}},Tile.prototype.getBottomArea=function(){switch(this.shape?.type){case"polygon":case"rectangle":let t=this.shape.path.map(t=>t[0]),e=t.sort((t,e)=>e-t)[0]-t.sort((t,e)=>t-e)[0],i=this.shape.path.map(t=>t[1]),s=i.sort((t,e)=>e-t)[0]-i.sort((t,e)=>t-e)[0];return e*s;case"circle":return PI*this.shape.radius}},Tile.prototype.setShape=function(t){this.shape=t},Tile.prototype.getDirection=function(){return new Vector2(cos(this.rotation),-sin(this.rotation))},Tile.prototype.getCollider=function(){switch(this.shape?.type){case"circle":return["circle",new Collider2D.Circle(new Collider2D.Vector(this.x,this.y),this.shape.radius)];case"polygon":case"rectangle":return["polygon",new Collider2D.Polygon(new Collider2D.Vector(this.x,this.y),(this.shape._lastPoints||this.shape.path).map(t=>new Collider2D.Vector(t[0],t[1])))];default:return null}},Tile.prototype.collidesWith=function(t,e=!1){let i=t=>t instanceof Collider2D.Circle?["circle",t]:t instanceof Collider2D.Polygon?["polygon",t]:(t.getCollider?t.getCollider():null)||["point",new Collider2D.Vector(t.x,t.y)],s=i(this),o=i(t);switch(s[0]){case"circle":switch(o[0]){case"circle":return collider.testCircleCircle(s[1],o[1],e);case"polygon":return collider.testPolygonCircle(o[1],s[1],e);case"point":return collider.pointInCircle(o[1],s[1],e);default:return!1}case"polygon":switch(o[0]){case"circle":return collider.testPolygonCircle(s[1],o[1],e);case"polygon":return collider.testPolygonPolygon(s[1],o[1],e);case"point":return collider.pointInPolygon(o[1],s[1],e);default:return!1}case"point":switch(o[0]){case"circle":return collider.pointInCircle(s[1],o[1],e);case"polygon":return collider.pointInPolygon(s[1],o[1],e);case"point":return this.equals(t);default:return!1}default:return!1}},Tile.prototype.getCollision=function(t){return Array.from(t.tiles).find(t=>t!==this&&t.collidesWith(this))},Tile.prototype.getCollisions=function(t){return Array.from(t.tiles).filter(t=>t!==this&&t.collidesWith(this))},Tile.prototype.move=function(t,e){if(this.isStatic)return!1;let i;i=this.getCollision(t);let s=()=>{let t={};if(i.shape&&i.shape.isPathShape){let e=i.shape._lastPoints||i.shape.path,s=e.map((t,s)=>{let o=e[e.length===s+1?0:s+1];return new Collider2D.Polygon(new Collider2D.Vector(i.x,i.y),[new Collider2D.Vector(t[0],t[1]),new Collider2D.Vector(o[0],o[1])])}).filter(t=>this.collidesWith(t)).map(t=>{let e={x:t.points[0].x+i.x,y:t.points[0].y+i.y},s={x:t.points[1].x+i.x,y:t.points[1].y+i.y},o=(s.y-e.y)/(s.x-e.x),n=e.y-o*e.x,r=1+o**2,a=(o*this.x+o**2*(this.y-n))/r+n;return[o,a]}).filter(t=>this.y<=t[1]).sort((t,e)=>e[1]-t[1])[0];s&&(abs(s[0])===1/0&&(s[0]=0),t.slope=s[0],this.rotationTarget=-atan(s[0]),t.rotation=-atan(s[0]),t.interY=s[1],90===this.rotationTarget&&(this.rotationTarget=0))}return t},o=this.clone(),n=this.rotationTarget,r=this.clone(),a=atan2(e.x,e.y),l=new Vector2(sin(a),cos(a)),h=ceil(e.len()/l.len()),c=min(h,t.maxRayCastingIterations),u=h/c;l.set(l.scale(u));let p=null;for(let f=0;f<c&&(o=this.clone(),f===c-1?this.set(r.add(e)):this.set(this.add(l)),!((i=this.getCollision(t))&&(n=this.rotationTarget,p=s(),this.getCollision(t))));f++);return!i||(this.airTicks=0,p&&(this.lastMoveGround=p,this.lastMoveGround.tile=i),this.set(o),this.rotation=n,!1)},Tile.prototype.update=function(t,e){if(e){if(this.dist(t.translation)>sqrt(((t.canvas?t.canvas.width:1e3)*(1/t.scale))**2+((t.canvas?t.canvas.height:1e3)*(1/t.scale))**2)/2+t.updateDistance)return this.outOfDistance=!0;if(this.outOfDistance=!1,t.warnOverDeltaTime&&e>100/t.timeScale&&console.warn(e),sqrt(2*this.mass*t.gravityAcceleration/(t.fluidDensity*sqrt(this.getBottomArea())*this.dragCoefficient)),!this.isStatic){isNaN(this.verticalVelocity)&&(this.verticalVelocity=0),isNaN(this.horizontalVelocity)&&(this.horizontalVelocity=0),this.gravityEnabled&&(this.verticalVelocity+=(this.mass*t.gravityAcceleration+this.force.y/this.mass)*e/1e3),this.move(t,new Vector2(0,this.verticalVelocity))||(this.lastMoveGround&&(this.lastMoveGround.tile.verticalVelocity+=this.verticalVelocity),this.verticalVelocity=0),this.horizontalVelocity+=this.getHorizontalAcceleration(t)*e/1e3;let i=this._Fs/this.mass*e/1e3,s=this.horizontalVelocity>0;this.horizontalVelocity+=(s?-1:1)*i,s!==this.horizontalVelocity>0&&(this.horizontalVelocity=0),this.move(t,new Vector2(sin(this.rotation+PI/2)*this.horizontalVelocity,cos(this.rotation+PI/2)*this.horizontalVelocity))||(this.lastMoveGround&&(this.lastMoveGround.tile.horizontalVelocity+=this.horizontalVelocity),this.horizontalVelocity=0),this.airTicks>3&&(this.rotationTarget>0&&(this.rotationTarget-=Math.PI/180*this.verticalVelocity),this.rotationTarget<0&&(this.rotationTarget+=Math.PI/180*this.verticalVelocity))}0!==round(this.motion.x)&&0!==round(this.motion.y)&&this.move(t,new Vector2(this.motion.x/10,this.motion.y/10)),this.motion.set(this.motion.scale(.9)),this.rotation=this.rotationTarget,!this.isStatic&&this.airTicks++}},Tile.prototype.isOnGround=function(){return this.airTicks<=2&&!!this.lastMoveGround},Tile.prototype.getLastGroundFrictionForce=function(){return this._lastHorizontalAcceleration&&this.isOnGround()?{frictionForce:this._Fs,kineticCoefficient:this._lastHorizontalAcceleration[1],staticCoefficient:this._lastHorizontalAcceleration[2]}:{frictionForce:0,kineticCoefficient:0,staticCoefficient:0}},Tile.prototype.getHorizontalAcceleration=function(t){this._lastHorizontalAcceleration||(this._lastHorizontalAcceleration=[]);let e=this.isOnGround(),i=e?this.lastMoveGround.tile.kineticFrictionCoefficient:0,s=e?this.lastMoveGround.tile.staticFrictionCoefficient:0,o=e?this.lastMoveGround.rotation:0,n=[e,i,s,o,this.force.x,this.force.y];if(n.every((t,e)=>t===this._lastHorizontalAcceleration[e]))return this._lastHorizontalAcceleration[6];this._lastHorizontalAcceleration=n;let r=-(this.mass*t.gravityAcceleration*sin(o)),a=this.mass*t.gravityAcceleration*cos(o),l=this.force.x/(-sin(o)||1),h=this.force.y/(cos(o)||1),c=a+h;this._N=c;let u=r+l;if(this._Fs=0,e){let p=i*c,f=s*c,y=u>f?p:u;0===u&&(y=p),this._Fs=y,this._Ffk=p,this._Ffs=f}return this._FNet=u,this._lastHorizontalAcceleration[6]=u/this.mass,this._lastHorizontalAcceleration[6]},Tile.prototype.resetVelocities=function(){this.verticalVelocity=0,this.horizontalVelocity=0,this.motion.set(Vector2.zero()),this.force.set(Vector2.zero())};let worlds={};function World(t,e){t.getContext&&(("object"!=typeof e||Array.isArray(e))&&(e={}),e.canvas=t,t=e),t=processOptions(t,[["render",{}],["render.collisions",{}],["render.collisions.color",""],["render.collisions.size",4],["scale",1],["maxRayCastingIterations",1e3],["updateDistance",1e4],["timeScale",1],["gravityAcceleration",2],["warnOverDeltaTime",!1]],2),this.options=t,this.scale=t.scale,this.translation=Vector2.zero(),this.tiles=new Set,this.canvas=t.canvas,this.ctx=t.canvas.getContext?t.canvas.getContext("2d"):t.ctx,this.gravityAcceleration=t.gravityAcceleration,this.fluidDensity=1.225,this.maxRayCastingIterations=t.maxRayCastingIterations,this.updateDistance=t.updateDistance,this.timeScale=t.timeScale,this.warnOverDeltaTime=t.warnOverDeltaTime;let i=_id++;worlds[i]=this,Object.defineProperty(this,"id",{get:()=>i}),this.update=function(){let t=worlds[i];t.tiles.forEach(function(e){e.update(t,(e.lastUpdate?Date.now()-e.lastUpdate:0)*t.timeScale),e.lastUpdate=Date.now()})},this.render=function(){let t=worlds[i];t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.tiles.forEach(function(e){e.shape&&e.shape.draw(t,e)})}}function Animator(...t){if(t.length>1)return t.map(t=>Animator(t));Array.isArray(t=t[0])||(t=[t]),t=new Set(t);let e=[],i=null,s=1,o="frame",n=async(r=!0)=>{if(t.forEach(t=>t()),s<=1)for(let a=0;a<1/s;a++)await new Promise(t=>i=("frame"===o?_requestAnimationFrame:setTimeout)(t));else for(let l=0;l<s;l++)await new Promise(t=>setTimeout(async()=>{await n(!1),t()}));e.push(Date.now()),e=e.filter(t=>t>Date.now()-1e3),r&&await n()};return n(),{getFrameId:()=>i,getFPS:()=>e.length,stop:()=>_cancelAnimationFrame(i),start(){_cancelAnimationFrame(i),n()},setTimeScale:t=>s=t,getTimeScale:()=>s,addCallback:e=>t.add(e),removeCallback:e=>t.delete(e),setMethod:t=>o=t}}World.getById=function(t){return worlds[t]},World.prototype.createAnimators=function(t){t=processOptions(t,{renderMethod:"frame",updateMethod:"timeout"});let e=Animator(this.render,this.update);return e[0].setMethod(t.renderMethod),e[1].setMethod(t.updateMethod),e},World.prototype.addHelpers=function(t){(t=processOptions(t,{center:!0,resize:!0,constraint:!0,mover:!0})).center&&centerCanvas(this.canvas),t.resize&&CanvasResizer(this.canvas),t.constraint&&MouseConstraint(this),t.mover&&CameraMover(this)},World.prototype.translate=function(t,e){this.translation.set(this.translation.add(new Vector2(t,e)))},World.prototype.translateScale=function(t,e=new Vector2(innerWidth/2,innerHeight/2)){this.scale+t<=0&&(t=-this.scale/10),this.scale+=t,this.translate(-e.x*t,-e.y*t)},World.prototype.addTile=function(t){this.tiles.add(t)},World.prototype.removeTile=function(t){this.tiles.delete(t)},World.prototype.getMouseVector=function(t){return new Vector2((t.offsetX||t.x)-this.translation.x,(t.offsetY||t.y)-this.translation.y).scale(1/this.scale)};let canvasResizeList=new Map;function CanvasResizer(t,e=1,i=1){if(!isWeb)throw Error("You can't use CanvasResizer method on a non-web platform.");t.width=window.innerWidth*e,t.height=window.innerHeight*i;let s=new Set;return canvasResizeList.set(t,[e,i,s]),{remove:()=>canvasResizeList.delete(t),addCallback:t=>s.add(t)}}function centerCanvas(t){if(!isWeb)throw Error("You can't use centerCanvas method on a non-web platform.");return t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.transform="translate(-50%, -50%)",{remove(){t.style.position="",t.style.left="",t.style.top="",t.style.transform=""}}}function MouseConstraint(t){if(!isWeb)throw Error("You can't use MouseConstraint method on a non-web platform.");if(!t)return console.warn("No world was given for MouseConstraint.");let e=_id++;t.mouseConstraints=[...t.mouseConstraints||[],e];let i=t.canvas,s=[],o=(t,e,i)=>{s.push(t,e,i),t.addEventListener(e,i)},n=!1,r=null;o(i,"mousedown",e=>{n=!0;let i=t.getMouseVector(e),s=Array.from(t.tiles),o;for(let a=0;a<s.length;a++){let l=s[a];if(l.collidesWith(i)){o=l;break}}o&&(r&&r.tile&&(r.tile.isStatic=r.gravity),r={tile:o,gravity:o.isStatic,mouse:i,tileVec:o.clone()},o.isStatic=!0)}),o(i,"mousemove",e=>{if(!n||!r)return;let i=t.getMouseVector(e);r.tile.set(r.tileVec.add(i.sub(r.mouse))),r.tile.resetVelocities()});let a=()=>{n=!1,r&&(r.tile.isStatic=r.gravity),r=null};return o(i,"mouseup",a),o(window,"blur",a),o(window,"mouseout",a),{remove(){s.forEach(t=>t[0].removeEventListener(...t.slice(1))),t.mouseConstraints=(t.mouseConstraints||[]).filter(t=>t!==e)}}}function CameraMover(t,e){if(!isWeb)throw Error("You can't use MouseConstraint method on a non-web platform.");if(!t)return console.warn("No world was given for MouseConstraint.");let i=_id++,s=t.canvas;e=processOptions(e,{zoom:!0,move:!0}),t.cameraMovers=[...t.cameraMovers||[],i];let o=[],n=(t,e,i)=>{o.push(t,e,i),t.addEventListener(e,i)};if(e.zoom&&n(s,"wheel",e=>{t.translateScale(-e.deltaY/5e3,new Vector2(e.offsetX,e.offsetY))}),e.move){let r=!1;n(s,"mousedown",e=>{let i=t.getMouseVector(e);t.mouseConstraints.length>0&&!Array.from(t.tiles).some(t=>t.collidesWith(i))&&(r=!0)}),n(s,"mousemove",e=>{r&&t.translate(e.movementX,e.movementY)}),n(s,"mouseup",()=>r=!1),n(window,"blur",()=>r=!1),n(window,"mouseout",()=>r=!1)}return{remove(){o.forEach(t=>t[0].removeEventListener(...t.slice(1))),t.cameraMovers=(t.cameraMovers||[]).filter(t=>t!==i)}}}isWeb&&addEventListener("resize",()=>{canvasResizeList.forEach((t,e)=>{e.width=window.innerWidth*t[0],e.height=window.innerHeight*t[1],t[2].forEach(t=>t())})}),extendClass(Polygon,PathShape),extendClass(Rectangle,PathShape),extendClass(Tile,Vector2),_exports.Phygic={Vector2,Shapes:{Circle,PathShape,Polygon,Rectangle},Tile,World,Utils:{Animator,CanvasResizer,centerCanvas,MouseConstraint,CameraMover},DevUtils:{processOptions,extendClass,positiveModulo}},_p(_exports.Phygic)}();
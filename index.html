<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Engine</title>
</head>
<body>
<canvas></canvas>
<div class="board">

</div>
<script src="engine.js"></script>
<script type="module">
    await window.Phygic;
    const {
        Vector2,
        Shapes,
        Tile,
        World,
        Utils: {Animator, CanvasResizer, centerCanvas, MouseConstraint, CameraMover}
    } = window.Phygic;
    const canvas = document.querySelector("canvas");

    const world = new World(canvas, {
        render: {
            collisions: {
                color: "#00ff00"
            }
        }
    });

    const MANUAL_ANIMATOR = false;

    if (MANUAL_ANIMATOR) {
        addEventListener("click", () => {
            world.update();
            world.render();
        });
    } else {
        const animator = Animator([world.update, world.render]);
        let frictionInfo;
        const board = [
            () => `${animator.getFPS()} frame/s`,
            () => `Δt = ${Date.now() - tile.lastUpdate} ms`,
            () => `m = ${tile.mass} kg`,
            () => `v<sub>v</sub> = ${tile.verticalVelocity.toFixed(2)} m/s`,
            () => `v<sub>h</sub> = ${tile.horizontalVelocity.toFixed(2)} m/s`,
            () => `θ = ${(tile.rotation / Math.PI * 180).toFixed(2)}°`,
            () => `F<sub>f</sub> = ${frictionInfo.frictionForce.toFixed(2)} N`,
            () => `μ<sub>s</sub> = ${frictionInfo.staticCoefficient.toFixed(2)}`,
            () => `μ<sub>k</sub> = ${frictionInfo.kineticCoefficient.toFixed(2)}`,
        ];
        animator.addCallback(() => {
            frictionInfo = tile.getGroundFrictionForce(world);
            document.querySelector(".board").innerHTML = board.map(i => `<div>${i()}</div>`).join("");
        });
    }
    centerCanvas(canvas);

    CanvasResizer(canvas);

    MouseConstraint(world);

    CameraMover(world);

    const tile = new Tile(50, 50, {shape: new Shapes.Rectangle(20, 20), world});

    new Tile(canvas.width / 2, canvas.height, {
        isStatic: true,
        shape: new Shapes.Rectangle(8000, 1),
        world
    });
    new Tile(0, canvas.height / 2, {
        isStatic: true,
        shape: new Shapes.Rectangle(1, 1000),
        world
    });
    new Tile(canvas.width, canvas.height / 2, {
        isStatic: true,
        shape: new Shapes.Rectangle(1, 1000),
        world
    });

    new Tile(300, 500, {
        isStatic: true, shape: new Shapes.Rectangle(10, 100), world,
        kineticFrictionCoefficient: 0, staticFrictionCoefficient: 0,
        rotation: Math.PI / 3
    });

    addEventListener("dblclick", ev => {
        const vec = world.getMouseVector(ev).sub(tile);
        const a = Math.atan2(vec.x, vec.y);
        const x = Math.sin(a);
        const y = Math.cos(a);
        tile.force.set(new Vector2(x, y).scale(10));
    });
    window.tt = tile;
    window.ww = world;
</script>
<style>
    * {
        font-family: Calibri, serif;
        user-select: none;
    }

    .board {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 100px;
        pointer-events: none;
    }
</style>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Engine</title>
</head>
<body>
<canvas></canvas>
<div class="board">

</div>
<script src="engine.js"></script>
<script type="module">
    await window.Phygic;
    const {
        Vector2,
        Shapes,
        Tile,
        World,
        Utils: {Animator, CanvasResizer, centerCanvas, MouseConstraint, CameraMover}
    } = window.Phygic;
    const canvas = document.querySelector("canvas");

    const world = new World(canvas, {
        render: {
            collisions: {
                color: "#00ff00"
            }
        }
    });

    const MANUAL_ANIMATOR = false;

    if (MANUAL_ANIMATOR) {
        addEventListener("click", () => {
            world.update();
            world.render();
        });
    } else {
        const animator = Animator([world.update, world.render]);
        const board = [
            () => `${animator.getFPS()} frame/s`,
            () => `Δt = ${Date.now() - tile.lastUpdate} ms`,
            () => `m = ${tile.mass} kg`,
            () => `v<sub>g</sub> = ${tile.gravitationalVelocity.toFixed(2)} m/s`,
            () => `v<sub>h</sub> = ${tile.horizontalVelocity.toFixed(2)} m/s`,
            () => `v<sub>h</sub> = ${(tile.rotation / Math.PI * 180).toFixed(2)}°`,
        ];
        animator.addCallback(() => {
            document.querySelector(".board").innerHTML = board.map(i => `<div>${i()}</div>`).join("");
        });
    }
    centerCanvas(canvas);

    CanvasResizer(canvas);

    MouseConstraint(world);

    CameraMover(world);

    const tile = new Tile(50, 50, {shape: new Shapes.Rectangle(20, 20), world});

    new Tile(canvas.width / 2, canvas.height, {
        gravityEnabled: false,
        shape: new Shapes.Rectangle(8000, 1),
        world
    });
    new Tile(0, canvas.height / 2, {
        gravityEnabled: false,
        shape: new Shapes.Rectangle(1, 1000),
        world
    });
    new Tile(canvas.width, canvas.height / 2, {
        gravityEnabled: false,
        shape: new Shapes.Rectangle(1, 1000),
        world
    });

    new Tile(300, 500, {
        gravityEnabled: false, shape: new Shapes.Polygon([
            [-100, -50],
            [10, 10],
            [-100, 10]
        ]), world
    });

    addEventListener("dblclick",ev=>{
        const vec = world.getMouseVector(ev).sub(tile);
        const a = Math.atan2(vec.x,vec.y);
        const x = Math.sin(a);
        const y = Math.cos(a);
        tile.force.set(new Vector2(x,y).scale(10));
    });
</script>
<style>
    * {
        font-family: Calibri, serif;
        user-select: none;
    }

    .board {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 100px;
        pointer-events: none;
    }
</style>
</body>
</html>